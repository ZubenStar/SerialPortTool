<Window
    x:Class="SerialPortTool.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Title="{x:Bind ViewModel.Title, Mode=OneWay}">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Menu Bar -->
        <MenuBar Grid.Row="0">
            <MenuBarItem Title="æ–‡ä»¶">
                <MenuFlyoutItem Text="æ–°å»ºè¿žæŽ¥" Click="NewConnection_Click"/>
                <MenuFlyoutSeparator/>
                <MenuFlyoutItem Text="é€€å‡º" Click="Exit_Click"/>
            </MenuBarItem>
            <MenuBarItem Title="å·¥å…·">
                <MenuFlyoutItem Text="æ‰«æä¸²å£" Command="{x:Bind ViewModel.ScanPortsCommand}"/>
                <MenuFlyoutItem Text="æ¸…ç©ºæ—¥å¿—"/>
            </MenuBarItem>
            <MenuBarItem Title="å¸®åŠ©">
                <MenuFlyoutItem Text="å…³äºŽ"/>
            </MenuBarItem>
        </MenuBar>

        <!-- Main Content -->
        <Grid Grid.Row="1" Padding="8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="250"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Sidebar -->
            <Grid Grid.Column="0" Padding="0,0,8,0">
                <StackPanel Spacing="16">
                    <!-- Port Configuration -->
                    <StackPanel Spacing="8">
                        <TextBlock Text="ä¸²å£é…ç½®"
                                   Style="{StaticResource SubtitleTextBlockStyle}"
                                   FontWeight="SemiBold"/>
                        
                        <StackPanel Spacing="4">
                            <TextBlock Text="æ³¢ç‰¹çŽ‡:" FontSize="12"/>
                            <ComboBox ItemsSource="{x:Bind ViewModel.AvailableBaudRates}"
                                      SelectedItem="{x:Bind ViewModel.BaudRate, Mode=TwoWay}"
                                      HorizontalAlignment="Stretch"/>
                        </StackPanel>
                        
                        <StackPanel Spacing="4">
                            <TextBlock Text="æ•°æ®ä½:" FontSize="12"/>
                            <ComboBox ItemsSource="{x:Bind ViewModel.AvailableDataBits}"
                                      SelectedItem="{x:Bind ViewModel.DataBits, Mode=TwoWay}"
                                      HorizontalAlignment="Stretch"/>
                        </StackPanel>
                    </StackPanel>

                    <!-- Available Ports -->
                    <StackPanel Spacing="8">
                        <TextBlock Text="å¯ç”¨ä¸²å£"
                                   Style="{StaticResource SubtitleTextBlockStyle}"
                                   FontWeight="SemiBold"/>
                        
                        <Button Content="ðŸ”„ æ‰«æä¸²å£"
                                Command="{x:Bind ViewModel.ScanPortsCommand}"
                                HorizontalAlignment="Stretch"/>
                        
                        <ListView x:Name="PortListView"
                                  ItemsSource="{x:Bind ViewModel.AvailablePorts, Mode=OneWay}"
                                  SelectionMode="Single"
                                  Height="100"
                                  SelectionChanged="PortListView_SelectionChanged">
                            <ListView.ItemTemplate>
                                <DataTemplate x:DataType="x:String">
                                    <Grid>
                                        <TextBlock Text="{x:Bind}" VerticalAlignment="Center"/>
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </StackPanel>

                    <!-- Open Ports -->
                    <StackPanel Spacing="8">
                        <TextBlock Text="å·²æ‰“å¼€ä¸²å£" 
                                   Style="{StaticResource SubtitleTextBlockStyle}"
                                   FontWeight="SemiBold"/>
                        
                        <ListView x:Name="OpenPortListView"
                                  ItemsSource="{x:Bind ViewModel.OpenPorts, Mode=OneWay}"
                                  SelectionMode="Single"
                                  Height="200">
                            <ListView.ItemTemplate>
                                <DataTemplate>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <StackPanel Grid.Column="0" Spacing="4">
                                            <TextBlock Text="{Binding PortName}"
                                                       FontWeight="SemiBold"/>
                                            <TextBlock Text="{Binding StatisticsDisplay, Mode=OneWay}"
                                                       FontSize="12"
                                                       Opacity="0.7"/>
                                        </StackPanel>
                                        
                                        <Button Grid.Column="1"
                                                Content="âŒ"
                                                FontSize="12"
                                                Padding="4"
                                                VerticalAlignment="Center"
                                                Click="ClosePort_Click"
                                                Tag="{Binding PortName}"/>
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </StackPanel>
                </StackPanel>
            </Grid>

            <!-- Main Content Area -->
            <Grid Grid.Column="1">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Search and Controls -->
                <StackPanel Grid.Row="0" Orientation="Horizontal" Padding="8" Spacing="8">
                    <TextBox x:Name="SearchBox"
                             PlaceholderText="æœç´¢æ—¥å¿—..."
                             TextChanged="SearchBox_TextChanged"
                             Width="300"/>
                    
                    <Button Content="æ¸…ç©º"
                            Click="ClearLogs_Click"/>
                    
                    <CheckBox Content="è‡ªåŠ¨æ»šåŠ¨"
                              IsChecked="{x:Bind ViewModel.AutoScroll, Mode=TwoWay}"
                              x:Name="AutoScrollCheckBox"/>
                </StackPanel>

                <!-- Logs Display with Virtualization -->
                <ListView Grid.Row="1"
                          x:Name="LogsListView"
                          ItemsSource="{x:Bind ViewModel.DisplayLogs, Mode=OneWay}"
                          SelectionMode="Extended"
                          Background="{ThemeResource LayerFillColorDefaultBrush}"
                          Padding="8">
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <TextBlock TextWrapping="Wrap" IsTextSelectionEnabled="True">
                                <Run Text="{Binding Timestamp, Mode=OneWay}"/>
                                <Run Text=" ["/>
                                <Run Text="{Binding Level, Mode=OneWay}"/>
                                <Run Text="] ["/>
                                <Run Text="{Binding PortName, Mode=OneWay}"/>
                                <Run Text="] "/>
                                <Run Text="{Binding Content, Mode=OneWay}"/>
                            </TextBlock>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>

                <!-- Send Area -->
                <StackPanel Grid.Row="2"
                            Spacing="8"
                            Padding="8"
                            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <TextBox x:Name="SendTextBox"
                                 Grid.Column="0"
                                 PlaceholderText="è¾“å…¥è¦å‘é€çš„æ•°æ®..."
                                 Margin="0,0,8,0"/>
                        
                        <Button Grid.Column="1"
                                Content="å‘é€"
                                Style="{StaticResource AccentButtonStyle}"
                                Click="SendButton_Click"/>
                    </Grid>
                </StackPanel>
            </Grid>
        </Grid>

        <!-- Status Bar -->
        <Grid Grid.Row="2" 
              Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
              Padding="8,4"
              BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
              BorderThickness="0,1,0,0">
            <TextBlock Text="{x:Bind ViewModel.StatusMessage, Mode=OneWay}"
                       VerticalAlignment="Center"/>
        </Grid>
    </Grid>
</Window>